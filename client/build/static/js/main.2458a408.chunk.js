(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{114:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),c=a(38),o=a.n(c),s=(a(48),a(19)),i=a(7),r=a(8),u=a(9),d=a(12),m=a(10),h=a(11),p=a(39),v=a(17),E=a.n(v),b=a(18),f=a.n(b),y=a(40),k=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(d.a)(this,Object(m.a)(t).call(this))).state={auth:"",code:""},e._confettiEffect=null,e.redirectTimeout=5e3,e}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=E.a.parse(this.props.location.search),t=setInterval(this.checkAuth.bind(this),1e3,1);this.setState({auth:e.auth,code:e.code,intervalId:t,authenticated:!1,opentok:null}),this._confettiEffect=new y.a({target:"auth-completed-confetti"})}},{key:"componentWillUnmount",value:function(){clearInterval(this.state.intervalId)}},{key:"checkAuth",value:function(){var e=this,t=this.state,a=t.auth,n=t.intervalId;this.props.history;f.a.post("https://auuubonz7g.execute-api.eu-west-2.amazonaws.com/dev/auth/check-auth-code",{authCode:a}).then(function(t){if(console.log("[checkAuth]",t),t&&t.data){var a=t.data.authResult,l=a.authenticated,c=a.opentok;e.setState({authenticated:l,opentok:JSON.stringify(c)}),l&&(e._confettiEffect.render(),clearInterval(n))}})}},{key:"onCompleteCountdown",value:function(){var e=this.props.history,t=this.state.opentok,a=JSON.parse(t),n=a.apiKey,l=a.sessionId,c=a.token;e.push("/videocall?token=".concat(c,"&apiKey=").concat(n,"&sessionId=").concat(l))}},{key:"rendererCountDown",value:function(e){var t=e.seconds;return l.a.createElement("span",null,t)}},{key:"render",value:function(){var e=this.state,t=e.code,a=e.authenticated;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"login-card Vlt-margin--top4"},l.a.createElement("div",{className:"Vlt-card",style:{minWidth:360}},l.a.createElement("div",{className:"Vlt-card__header"},l.a.createElement("h2",null,"Authentication page")),l.a.createElement("h5",{className:"Vlt-center"},"To authenticate, please send back the code below to the same number that sent you the SMS:"),l.a.createElement("div",{className:"login-code-text letter-spacing"},l.a.createElement("span",null,t)),a?l.a.createElement("div",{className:"Vlt-center"},l.a.createElement("h3",{className:"Vlt-green"},"Authenticated"),l.a.createElement("h4",{className:"Vlt-green"},l.a.createElement("span",null,"You will now be redirected to the videocall in: "),l.a.createElement(p.a,{date:Date.now()+this.redirectTimeout,onComplete:this.onCompleteCountdown.bind(this),renderer:this.rendererCountDown}))):l.a.createElement("div",{className:"Vlt-center"},l.a.createElement("div",{className:"Vlt-spinner "})),l.a.createElement("div",{className:"Vlt-center"},l.a.createElement("button",{className:"Vlt-btn Vlt-btn--tertiary"},l.a.createElement(s.b,{to:"/"},"Go Back to login page"))))),l.a.createElement("canvas",{id:"auth-completed-confetti"}))}}]),t}(n.Component),V=Object(i.e)(k),g=a(15),N=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(d.a)(this,Object(m.a)(t).call(this))).state={recipient:"",smsSent:!1,apiKey:"",sessionId:"",token:""},e.handleChange=e.handleChange.bind(Object(g.a)(e)),e.sendSMS=e.sendSMS.bind(Object(g.a)(e)),e}return Object(h.a)(t,e),Object(u.a)(t,[{key:"handleChange",value:function(e){this.setState({recipient:e.target.value})}},{key:"sendSMS",value:function(){var e=this,t=this.state,a=t.recipient,n=t.smsSent;a&&!n&&f.a.post("https://auuubonz7g.execute-api.eu-west-2.amazonaws.com/dev/auth/create-auth-code",{recipient:a}).then(function(t){var a=t.data.opentok;e.setState({smsSent:!0,apiKey:a.apiKey,sessionId:a.sessionId,token:a.adminToken})})}},{key:"render",value:function(){var e=this.state,t=e.recipient,a=e.smsSent,n=e.apiKey,c=e.sessionId,o=e.token,s="".concat("https://d3dqye79o8tcoo.cloudfront.net","/videocall?token=").concat(o,"&apiKey=").concat(n,"&sessionId=").concat(c);return l.a.createElement("div",{className:"Vlt-grid Vlt-margin--top4",style:{justifyContent:"center"}},l.a.createElement("div",{className:"Vlt-col Vlt-col--1of2"},l.a.createElement("div",{className:"Vlt-card"},l.a.createElement("div",{className:"Vlt-card__header"},l.a.createElement("h2",null,"Send appointment reminder to the user")),l.a.createElement("div",{className:"Vlt-form__element"},l.a.createElement("label",{className:"Vlt-label",htmlFor:"phone-number-input"},"Insert user's phone number. "),l.a.createElement("div",{className:"Vlt-input"},l.a.createElement("input",{value:t,style:{width:250},type:"number",id:"phone-number-input",onChange:this.handleChange})),l.a.createElement("button",{className:"Vlt-btn Vlt-btn--secondary Vlt-btn--app",onClick:this.sendSMS},"Send")),a&&l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"Vlt-callout Vlt-callout--good"},l.a.createElement("i",null),l.a.createElement("div",{className:"Vlt-callout__content"},"Great! Now you can join the videocall")),l.a.createElement("div",{className:"Vlt-center"},l.a.createElement("a",{style:{margin:0},className:"Vlt-btn Vlt-btn--primary",target:"_blank",href:s,rel:"noopener noreferrer"},"Join videocall"))))))}}]),t}(n.Component),w=a(16),S=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(d.a)(this,Object(m.a)(t).call(this))).apiKey="",e.sessionId="",e.token="",e.state={startVideoCall:!1},e}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=E.a.parse(this.props.location.search);this.apiKey=e.apiKey,this.sessionId=e.sessionId,this.token=e.token,this.setState({startVideoCall:!0})}},{key:"render",value:function(){return this.state.startVideoCall?l.a.createElement("div",{className:"videocall-container"},l.a.createElement("div",{className:"videocall-header"},l.a.createElement("h3",{style:{color:"#fff"}},"Videocall")),l.a.createElement("div",{className:"webcam-container"},l.a.createElement(w.OTSession,{apiKey:this.apiKey,sessionId:this.sessionId,token:this.token},l.a.createElement(w.OTPublisher,null),l.a.createElement(w.OTStreams,null,l.a.createElement(w.OTSubscriber,null))))):null}}]),t}(n.Component);var O=function(){return l.a.createElement(s.a,null,l.a.createElement("div",null,l.a.createElement(i.c,null,l.a.createElement(i.a,{path:"/videocall/",component:S}),l.a.createElement(i.a,{path:"/login/",component:V}),l.a.createElement(i.a,{component:N,exact:!0}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(l.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},43:function(e,t,a){e.exports=a(114)},48:function(e,t,a){}},[[43,1,2]]]);
//# sourceMappingURL=main.2458a408.chunk.js.map